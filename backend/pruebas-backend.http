### ==============================================
### LOGIN
### ==============================================

### 1. Autenticarse y guardar el token
# @name login
POST http://localhost:8080/api/authenticate
Content-Type: application/json

{
  "username": "admin",
  "password": "admin",
  "rememberMe": true
}

> {%
  client.global.set("jwt_token", response.body.id_token);
%}

### ==============================================
### TAREAS DE ADMINISTRACIÓN
### ==============================================

### 2. SINCRONIZAR EVENTOS
# @name sincronizarEventos
POST http://localhost:8080/api/flujo/sincronizar
Authorization: Bearer {{jwt_token}}

###
### 3. VERIFICAR BASE DE DATOS
# @name verEventosLocales
GET http://localhost:8080/api/eventos
Authorization: Bearer {{jwt_token}}

###

### 4. VERIFICAR HISTORIAL DE VENTAS (Leer la BD local)
# @name verHistorialVentas
GET http://localhost:8080/api/ventas
Authorization: Bearer {{jwt_token}}

###
### 5. VER HISTORIAL DE VENTAS (CÁTEDRA)
# (Requiere VPN y TOKEN_JWT_CATEDRA)
# @name verHistorialCatedra
GET http://localhost:8080/api/admin/catedra-ventas
Authorization: Bearer {{jwt_token}}

###
### 6. VER DETALLE DE VENTA (CÁTEDRA)
# (Requiere VPN y TOKEN_JWT_CATEDRA)
# @name verDetalleVentaCatedra
GET http://localhost:8080/api/admin/catedra-ventas
Authorization: Bearer {{jwt_token}}

###
### ----------------------------------------------------
### Flujo de compra
### ----------------------------------------------------
###

### 4. Seleccionar Evento (Paso b)
# @name seleccionarEvento
POST http://localhost:8080/api/sesion/seleccionar-evento
Authorization: Bearer {{jwt_token}}
Content-Type: application/json

{
  "eventoId": 2828
}

###
### 5. Agregar Asiento (Paso c)
# @name agregarAsiento
POST http://localhost:8080/api/sesion/agregar-asiento
Authorization: Bearer {{jwt_token}}
Content-Type: application/json

{
  "fila": 1,
  "columna": 1
}

###
### 6. Cargar Nombres (Paso d)
# @name cargarNombres
POST http://localhost:8080/api/sesion/cargar-nombres
Authorization: Bearer {{jwt_token}}
Content-Type: application/json

{
  "asientos": [
    {
      "fila": 1,
      "columna": 1,
      "persona": "Juan Perez"
    }
  ]
}

###
### 7. Bloquear Asientos (Llamada a Cátedra)
# @name bloquearAsientos
POST http://localhost:8080/api/flujo/bloquear-asientos
Authorization: Bearer {{jwt_token}}

### 8. REALIZAR VENTA (Confirmar Compra)
# Llama a Cátedra para concretar la venta y guarda el resultado en tu MySQL local.
# (Requiere haber pasado por 'bloquear-asientos' exitosamente)
# @name realizarVenta
POST http://localhost:8080/api/flujo/realizar-venta
Authorization: Bearer {{jwt_token}}


###
### 8. CERRAR SESIÓN (Paso 4.5)
# Esto llamará al /api/logout, que ahora incluye nuestro CustomLogoutHandler.
# @name logout
POST http://localhost:8080/api/sesion/logout
Authorization: Bearer {{jwt_token}}

###
### 9. VERIFICACIÓN DE LOGOUT (Prueba)
# Para verificar, volvemos a loguearnos (obteniendo un NUEVO token)
# y pedimos el estado. Debería estar reseteado.
# @name loginAgain
POST http://localhost:8080/api/authenticate
Content-Type: application/json

{
  "username": "admin",
  "password": "admin",
  "rememberMe": true
}

> {%
  client.global.set("jwt_token_2", response.body.id_token);
%}

###
# @name getEstadoDespuesDeLogout
GET http://localhost:8080/api/sesion/estado
Authorization: Bearer {{jwt_token_2}}

###

# @name notificarEvento
POST http://localhost:8080/api/notificaciones/evento-actualizado
Authorization: Bearer {{jwt_token}}

### ==============================================
### 5. OBTENER MAPA DE ASIENTOS REALES (PRUEBA DE PROXY)
### ==============================================
# Este request llama al Backend, que a su vez llama al Proxy (localhost:8081).
# @name obtenerMapaAsientos
GET http://localhost:8080/api/eventos/2828/asientos
Authorization: Bearer {{jwt_token}}

### HERRAMIENTA DE EMERGENCIA: FORZAR ACTUALIZACIÓN
# Esto regenera los eventos en el servidor de la Cátedra.
# @name forzarActualizacion
GET http://192.168.194.250:8080/api/endpoints/v1/forzar-actualizacion
Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ2aWN0b3JpYXRvcnJlc2J1cmdvcyIsImV4cCI6MTc2Njc4Nzg3NiwiYXV0aCI6IlJPTEVfVVNFUiIsImlhdCI6MTc2NDE5NTg3Nn0.Y9VSeYT93ZJAqi-yvLKmTLsABOUyh3JRghZMyMuvziwc-c69SePrik67Ti9nbYqUTu9BADCXbWWPMBQYTtawcQ
# (Nota: Si este token no funciona, usa el token manual de Cátedra que exportaste)
